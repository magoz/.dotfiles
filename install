#!/bin/bash

# set current directory, in case the script is called from another directory.
cd "$(dirname "$0")" || exit

# --------------------------------------
# ------ CLEANUP EXISTING CONF ---------
# --------------------------------------
rm -rf tmux/.config/tmux/plugins
rm ~/.gitconfig
rm ~/.zprofile

# --------------------------------------
# ---------  INSTALL PACKAGES ----------
# --------------------------------------
echo "ðŸº Installing basic config packages with Homebrew"
brew install \
  bat \
  git \
  fnm \
  jq \
  wezterm \
  font-meslo-lg-nerd-font \
  neovim \
  nikitabobko/tap/aerospace \
  stow \
  tmux \
  opencode \
  zsh \
  eza \
  zoxide \
  fzf \
  powerlevel10k \
  zsh-autosuggestions \
  zsh-syntax-highlighting \
  zsh-completions

# Borders
brew tap FelixKratz/formulae
brew install borders

# --------------------------------------
# --------------  STOW -----------------
# --------------------------------------
./stow.sh

# --------------------------------------
# --------------  ZSH ------------------
# --------------------------------------
rm -f ~/.zcompdump
compinit # zsh-completions

# --------------------------------------
# -------------  NEOVIM ----------------
# --------------------------------------
# Plugins dependencies
# telescope uses fd and ripgrep

echo "âš¡ Setting up Neovim"
brew install \
  fd \
  lazygit \
  ripgrep

# Install plugins
nvim --headless "+Lazy! sync" +qa

# --------------------------------------
# ------------- BORDERS ----------------
# --------------------------------------
brew services restart borders

# --------------------------------------
# ------------- TMUX ----------------
# --------------------------------------
tmux source "$HOME/.config/tmux/tmux.conf"
echo "âœ… Sourced Tmux"

# --------------------------------------
# ------  INSTALL DEV PACKAGES ---------
# --------------------------------------
# tlrc is tldr
echo "ðŸš€ Installing DEV packages with Homebrew"
brew install \
  tlrc

# pnpm (standalone, works with fnm)
if ! command -v pnpm &>/dev/null; then
  curl -fsSL https://get.pnpm.io/install.sh | sh -
  # Installer appends to .zshrc but we already have PNPM_HOME in zsh-exports
  sed -i '' '/# pnpm/,/# pnpm end/d' "$HOME/.config/zsh/.zshrc"
else
  echo "pnpm already installed, skipping"
fi
